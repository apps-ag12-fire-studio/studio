
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Permite acesso a arquivos dentro de pastas de usuários/processos.
    // O primeiro segmento do caminho será algo como "user-processId123" ou "user-unknown_process".
    // O segundo segmento 'category' será "original_contracts", "docs", ou "signed_contracts".
    // 'allPaths=**' captura o restante do caminho, incluindo subpastas de documentos e o nome do arquivo.
    //
    // Exemplos de caminhos que esta regra cobrirá:
    // - user-someProcessId/original_contracts/arquivo.jpg
    // - user-someProcessId/docs/rgFrente/arquivo.jpg
    // - user-unknown_process/signed_contracts/arquivo.jpg
    match /{userProcessFolder}/{category}/{allPaths=**} {
      allow read, write: if true; // Para desenvolvimento. Restrinja para produção!
    }

    // Regras antigas (opcional, para compatibilidade se arquivos já existirem nesses caminhos)
    // Se você tiver certeza de que não há arquivos nos caminhos antigos ou não precisa mais deles,
    // pode remover estas regras comentadas para manter as regras mais limpas.
    // match /original_contracts/{allPaths=**} { allow read, write: if true; }
    // match /buyer_documents/{allPaths=**} { allow read, write: if true; }
    // match /signed_contracts/{allPaths=**} { allow read, write: if true; }
  }
}
